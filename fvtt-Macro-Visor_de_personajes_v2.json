{
  "name": "Visor de personajes",
  "type": "script",
  "sort": 100001,
  "flags": {
    "exportSource": {
      "world": "aquelarre",
      "system": "sandbox",
      "coreVersion": "0.7.9",
      "systemVersion": "0.7.6"
    }
  },
  "scope": "global",
  "command": "let html = `\n  <script>\n  // --------------------------------------------------------------------------------------\n  // Change settings to fit your needs\n  // Properties format entered is 'Name of sandbox property key;Any label you want to show'\n  // if you dont need a special label just use the propertykey(without any ;)\n  // \n  // To change the width of the form(dialog), change the rows at the bottom with\n  //   d.options.width = 450;\n  //   d.position.width = 450;\n  //\n  // Macro by Ramses800, 2021-03-23\n  // ---------------------------------------------------------------------------------------\n  function Setting_PropertiesRequested() {return ['key1','key2','key3','key4','key5','key6'];  } \n  function Setting_Foldername()          {return 'CARPETA_DE_ACTORES';  }\n  </script>  \n  <style>\n  .hbo:hover {box-shadow:0 0 5px red}\n  </style>\n  <table id=\"CharactersProperties\">\n  </table>\n  <div>\n  <script>\n  // ----------------------\n  // Generic code below\n  // ----------------------\n  function splitString(sInput,sSeparator,iFieldNr)\n  {\n    let arr=sInput.split(sSeparator);\n    if(arr.length>0 && arr.length>iFieldNr )\n  \t{\n      return arr[iFieldNr];\n    }\n    else\n    {\n      return sInput;\n    }\n  }\n  function singleQuote()\n  {\n    return '&quot;';\n  }\n  function rollActorProperty(actorId,sPropertyId )\n  {\n   let actor = game.actors.get(actorId);\n   let actorattributes = actor.data.data.attributes;\n   console.log(sPropertyId + ':' + actor.data.name);\n   let rollexp;\n   let rollname;\n   let rollid = [];\n   let property = game.items.get(sPropertyId );\n   rollexp = property.data.data.rollexp;\n   rollname = property.data.data.rollname;\n   rollid.push(property.data.data.rollid);\n   actor.rollSheetDice(rollexp,rollname,rollid,actorattributes,null);\n  }\n  function ListActorsProperties(foldername,requestedpropertiesstringarray){\n    let table = document.getElementById(\"CharactersProperties\");\n    // empty table\n    if (table.rows.length>0)\n    {\n      for(let i=table.rows.length;i>=1;i--){\n        table.deleteRow(-1);\t\n      }\n    }\n    // build table    \n\tlet folder = game.folders.getName(foldername);\n\theader = table.createTHead();\n\tlet row = header.insertRow(0);\n        let hCell=row.insertCell(-1);\n        let sHCell = '<th style=\"text-align:left;padding-left:5px;\"><i title=\"Refresh\" class=\"fas fa-redo-alt hbo\"'; \n        sHCell += ' style=\"border: 0px groove #c9c7b8;border-radius: 3px;padding:3px 3px 3px 3px;\"';\n        sHCell += ' onclick=\"ListActorsProperties(Setting_Foldername(),Setting_PropertiesRequested());\"'; \n        sHCell += ' ></i> </th>';\n        hCell.outerHTML  = sHCell;     \n\trow.insertCell(-1).outerHTML = '<th></th>';\n\t\n\tfor (let sProperty of requestedpropertiesstringarray ){  \t\n           \n\t\trow.insertCell(-1).outerHTML = '<th style=\"vertical-align: bottom;word-wrap: break-word;padding-left:5px;padding-right:5px;\">' + splitString(sProperty,';',1) +  '</th>';\n\t}\n\tfor(let actor of folder.content){\n\t  console.log(actor);\n\t  let row = table.insertRow(-1);\n          row.style.lineHeight=\"12px\";\n\t  row.insertCell(-1).outerHTML = '<td style=\"text-align:left;display: block;padding:2px 0px 0px 2px;vertical-align:middle;\"><img style=\"height:48px;width:48px;object-fit:cover;object-position:50% 0;margin: 0 8px 0 2px;border: none;\" src=\"' + actor.data.img +'\"</img></td>';\n\t  row.insertCell(-1).outerHTML = '<td style=\"padding-left:2px;\">' + actor.name +'</td>';\n\t  let targetattributes=actor.data.data.attributes;\n          \n          let sPropertyName='';\n          let property;\n          let sAttrID='';\n\t  for (let sProperty of requestedpropertiesstringarray ){\n            sPropertyName=splitString(sProperty,';',0);\n\t  \t  let cell=row.insertCell(-1);\n\t  \t  cell.style.textAlign = \"center\";\n\t\t  if (targetattributes[sPropertyName]!=null)\n\t\t  {\t\t\t\n                       cell.innerHTML=targetattributes[sPropertyName].value;\n                       sAttrID=targetattributes[sPropertyName].id;\n\t\t       property = game.items.get(sAttrID);\n                       rollexp = property.data.data.rollexp;                       \n                       if (rollexp!=null)\n                       {\n                          if (rollexp.length>0)\n                         {  \n                          cell.innerHTML='<label class=\"hbo\" onclick=\"rollActorProperty(' + singleQuote() + actor._id  + singleQuote() +','+ singleQuote()+ sAttrID + singleQuote() +');\">' + targetattributes[sPropertyName].value+ ' </a>';\n                         }\n                       }\n\t\t  }\n\t\t  else\n\t\t  {\n\t\t\tcell.innerHTML=\"N/A\";\n\t\t  }\n\t\t}\n\t  }\n  }  \n  ListActorsProperties(Setting_Foldername(),Setting_PropertiesRequested());\n  </script>\n`;\n// HTML Form completed\n// show it as dialog\nlet d = new Dialog({\n title: \"Visor de personajes\",\n content: html,\n buttons: {\n  }\n ,\n \n \n});\nd.options.width = 450;\nd.position.width = 450;\nd.render(true);",
  "author": "NLu8dzFBI3Kvrwky",
  "img": "icons/svg/dice-target.svg",
  "actorIds": [],
  "_id": "mxnfcu3sUMe6BJan"
}